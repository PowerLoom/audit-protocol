# Powerloom-protocol

Audit data by snapshotting payloads. Keep track of changes for each successive payload committed. 
Proof for the state for each payload at a particular time is represented by the transaction hash 
generated by committing the payload Cid to a smart contract. Each payload Cid is also wrapped up 
in a DAG structure, and each DAG structure houses the cid of the previous DAG, along with the
transaction hash for the payload and timestamp at which that payload was committed.

First copy the settings example files
```shell
cp settings.example.json settings.json
cp docker_settings.example.json docker_settings.json
```

Replace the following fields in settings.json docker_settings.json with your specific values
- audit_contract: Address of the AuditRecordStore contract that you have deployed
- api_key: The api key present in your maticvigil settings file

Start your webhook tunnel to port specified in the webhook listener port in settings.json or docker_settings.json

Run the docker:
```
./run_docker.sh
```

Try to commit some payload:
```shell
curl --location --request POST 'http://127.0.0.1:9000/commit_payload' \
--header 'Content-Type: text/plain' \
--data-raw '{
  "payload": {
      "test_field_a": "put any kind data here",
      "test_field_b": {
          "key_a": [1, 2],
          "key_b": 5000
      }
  },
  "projectId": "test_project_1"
}

```
The response you get should be:
```shell
{
    "cid": "QmQa7YZLitKkcMwRmZnx93wSEYjmtUxZgfdMJ1TQwSxgDa",
    "tentativeHeight": 1,
    "payloadChanged": true
}
```

There are 3 fields in the above response body:

- cid: This represents the content-identifier for the payload committed. It is a unique
hash for the payload field.
  
- tentativeHeight: Every new payload committed will have height that represents its position
in the chain of payloads committed. However tentativeHeight is not a deterministic value. If
  the proof for this payload is not recieved in the backend, the payload is discarded.
  
- payloadChanged: Represents whether the payload has changed from previous commit or not


There are endpoints which you can access to get dag blocks and retrieve the complete payload data:
- POST /commit_payload
- POST /{projectID}/diffRules
- GET /{prjectID}/getDiffRules
- GET /{projectID}/payloads/height
- GET /{projectID}/payload/{blockHeight}
- GET /{projectID}/payload/{blockHeight}/data
- GET /{projectID}/payloads
- GET /requests/{requestID}
- GET /projects/updates
- GET /{projectID}/payloads/cachedDiffs/count
- GET /{projectID}/payloads/cachedDiffs